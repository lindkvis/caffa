<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Caffa: About Caffa</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Caffa
   &#160;<span id="projectnumber">1.1.0</span>
   </div>
   <div id="projectbrief">C++ Application Framework for Embedded Systems with introspection</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">About Caffa </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__home_glindkvist_Projects_aru_server_app_frameworks_caffa_docs_README"></a>Caffa is an Application Framework for Embedded server applications written in C++. It features Runtime Introspection, serialisation and a REST-interface</p>
<p>Caffa is intended to help write applications with strong separation between application logic and the data model and allow for unforseen new methods of accessing objects using introspection. The main target for Caffa is to create simple control applications for embedded Linux systems or client/server c++-applications with a shared client and server code base.</p>
<p>As an example, you would write Data Model Objects with Fields holding data instead of simple variables. This gives you runtime introspection of the fields without using a pre-compiler and all objects can easily be written out to JSON. Caffa is set up for allowing scripting access by utilising the introspection capabilites to optionally expose fields and objects to scripting languages with little additional work from the application developer.</p>
<p>The REST-interface is designed to be as transparent as possible, and fields and methods can be accessed remotely from the client as if they are local fields through the use of remote REST-accessors being applied to them when the object is instantiated on the client.</p>
<p>The REST-interface communicates via JSON adhering to the latest draft <a href="http://json-schema.org/">JSON Schema</a> specification and the REST-server provides access to both schemas and data.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"><span class="preprocessor">#include &quot;cafObject.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacecaffa.html">caffa</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>ChildObject : <span class="keyword">public</span> Object</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Repeat the class name and parent Caffa Object</span></div>
<div class="line">    <span class="comment">// This registers methods for inspecting the class hierarchy</span></div>
<div class="line">    CAFFA_HEADER_INIT(DemoObject, Object)</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="comment">// Caffa classes must be default instantiable, since they are created by a factory for serialization</span></div>
<div class="line">    <span class="comment">// But as long as they have default values for all parameters, we are good!</span></div>
<div class="line">    ChildObject(<span class="keyword">const</span> std::string&amp; childName = <span class="stringliteral">&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    Field&lt;std::string&gt; name;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>TinyDemoDocument : <span class="keyword">public</span> Document</div>
<div class="line">{</div>
<div class="line">    CAFFA_HEADER_INIT_WITH_DOC(<span class="stringliteral">&quot;A tiny object with documentation&quot;</span>, TinyDemoDocument, Object);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    <span class="keyword">enum</span> TestEnumType</div>
<div class="line">    {</div>
<div class="line">        T1,</div>
<div class="line">        T2,</div>
<div class="line">        T3</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    TinyDemoDocument();</div>
<div class="line">    ~TinyDemoDocument() noexcept override;</div>
<div class="line"> </div>
<div class="line">public:</div>
<div class="line"> </div>
<div class="line">    Field&lt;<span class="keywordtype">bool</span>&gt;                     toggleField;</div>
<div class="line">    Field&lt;<span class="keywordtype">double</span>&gt;                   doubleField;</div>
<div class="line">    Field&lt;<span class="keywordtype">int</span>&gt;                      intField;</div>
<div class="line">    Field&lt;std::vector&lt;<span class="keywordtype">int</span>&gt;&gt;         intVectorField;</div>
<div class="line">    Field&lt;AppEnum&lt;TestEnumType&gt;&gt;    enumField;</div>
<div class="line">    ChildArrayField&lt;ChildObject&gt;    children; <span class="comment">// ChildArrayFields hold a vector of Caffa Objects</span></div>
<div class="line">    ChildField&lt;ChildObject&gt;         specialChild; <span class="comment">// Child fields hold a single Caffa Object</span></div>
<div class="line"> </div>
<div class="line">public:</div>
<div class="line">    Method&lt;<span class="keywordtype">void</span>(<span class="keywordtype">double</span>)&gt;            scaleDoubleField; <span class="comment">// A registered method</span></div>
<div class="line">};</div>
<div class="ttc" id="anamespacecaffa_html"><div class="ttname"><a href="namespacecaffa.html">caffa</a></div><div class="ttdoc">Main Caffa namespace.</div><div class="ttdef"><b>Definition:</b> __init__.py:1</div></div>
</div><!-- fragment --><p>In the cpp file you then register the object and fields.</p>
<div class="fragment"><div class="line">CAFFA_SOURCE_INIT(ChildObject)</div>
<div class="line"> </div>
<div class="line">ChildObject::ChildObject(<span class="keyword">const</span> std::string&amp; childName)</div>
<div class="line">{</div>
<div class="line">    initField(name, <span class="stringliteral">&quot;name&quot;</span>).withDefault(childName).withScripting();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">CAFFA_SOURCE_INIT(TinyDemoDocument)</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Must be in caffa namespace</span></div>
<div class="line"><span class="keyword">namespace </span><a class="code" href="namespacecaffa.html">caffa</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">template</span> &lt;&gt;</div>
<div class="line"><span class="keywordtype">void</span> AppEnum&lt;TinyDemoDocument::TestEnumType&gt;::setUp()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Register enum values with a corresponding text string</span></div>
<div class="line">    addItem( TinyDemoDocument::T1, <span class="stringliteral">&quot;T1&quot;</span> );</div>
<div class="line">    addItem( TinyDemoDocument::T2, <span class="stringliteral">&quot;T2&quot;</span> );</div>
<div class="line">    addItem( TinyDemoDocument::T3, <span class="stringliteral">&quot;T3&quot;</span> );</div>
<div class="line">    setDefault( TinyDemoDocument::T1 );</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">} <span class="comment">// namespace caffa</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">TinyDemoDocument::TinyDemoDocument()</div>
<div class="line">{</div>
<div class="line">    initField(toggleField, <span class="stringliteral">&quot;Toggle&quot;</span>).withDefault(<span class="keyword">true</span>).withScripting();    </div>
<div class="line">    initField(doubleField, <span class="stringliteral">&quot;Number&quot;</span>).withDefault(11.0).withScripting();</div>
<div class="line">    initField(intField, <span class="stringliteral">&quot;Integer&quot;</span>).withDefault(42).withScripting();</div>
<div class="line">    initField(enumField, <span class="stringliteral">&quot;Enum&quot;</span>).withScripting();</div>
<div class="line">    initField(intVectorField, <span class="stringliteral">&quot;Integers&quot;</span>).withScripting();</div>
<div class="line">    initField(children, <span class="stringliteral">&quot;Children&quot;</span>).withScripting();</div>
<div class="line">    initFIeld(specialChild, <span class="stringliteral">&quot;SpecialChild&quot;</span>); <span class="comment">// Omitted withScripting =&gt; not remote accessible.</span></div>
<div class="line">    </div>
<div class="line">    initMethod(scaleDoubleField, <span class="stringliteral">&quot;scaleDouble&quot;</span>, {<span class="stringliteral">&quot;scalingFactor&quot;</span>}, [<span class="keyword">this</span>](<span class="keywordtype">double</span> scalingFactor)</div>
<div class="line">    {</div>
<div class="line">        this-&gt;doubleField.setValue(this-&gt;doubleField.value() * scalingFactor);</div>
<div class="line">    });</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Add a couple of children to the child array field</span></div>
<div class="line">    children.push_back(std::make_shared&lt;ChildObject&gt;(<span class="stringliteral">&quot;Alice&quot;</span>));</div>
<div class="line">    children.push_back(std::make_shared&lt;ChildObject&gt;(<span class="stringliteral">&quot;Bob&quot;</span>));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set the single child object</span></div>
<div class="line">    specialChild = std::make_shared&lt;ChildObject&gt;(<span class="stringliteral">&quot;Balthazar&quot;</span>);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Fields and methods can be accessed locally in the following way: </p><div class="fragment"><div class="line"><span class="keyword">auto</span> doc = std::make_shared&lt;TinyDemoDocument&gt;();</div>
<div class="line">doc-&gt;toggleField = <span class="keyword">true</span>;</div>
<div class="line"><span class="keywordtype">int</span> currentIntValue = doc-&gt;intField;</div>
<div class="line">doc-&gt;scaleDoubleField(3.0);</div>
</div><!-- fragment --><p>If your application inherits the <a class="el" href="classcaffa_1_1rpc_1_1RestServerApplication.html">caffa::rpc::RestServerApplication</a> and the document is provided by the server app through your implementation of the virtual document and documents() methods, you can access the same fields and methods remotely.</p>
<div class="fragment"><div class="line"><span class="comment">// The result of the document method is a generic document, so need casting.</span></div>
<div class="line"><span class="keyword">auto</span> doc = std::dynamic_pointer_cast&lt;TinyDemoDocument&gt;(client-&gt;document(<span class="stringliteral">&quot;TinyDemoDocument&quot;</span>));</div>
<div class="line">doc-&gt;toggleField = <span class="keyword">true</span>;</div>
<div class="line"><span class="keywordtype">int</span> currentIntValue = doc-&gt;intField;</div>
<div class="line">doc-&gt;scaleDoubleField(3.0);</div>
</div><!-- fragment --><p>See <a href="https://github.com/lindkvis/caffa/blob/master/RestInterface/RestInterface_Example/ExampleServer.cpp">ExampleServer.cpp</a> and <a href="https://github.com/lindkvis/caffa/blob/master/RestInterface/RestInterface_Example/ExampleClient.cpp">ExampleClient.cpp</a> for a more complete example.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Requirements</h1>
<p>Caffa uses modern C++ and requires a C++20 compatible compiler, Boost 1.71.0+ and CMake 3.16+.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Building</h1>
<p>Caffa uses git submodules so it is important to initialise submodules recursively first</p>
<div class="fragment"><div class="line">git submodule update --init --recursive</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md11"></a>
Licensing</h1>
<p>Caffa is licensed under the LGPL 2.1 or newer. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
